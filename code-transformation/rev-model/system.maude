mod SYSTEM is protecting SEM_ENTITY_WITH_KEY . including BOOL . protecting META-LEVEL . protecting MAUDE-SYNTAX-UPDOWN . protecting SEM_ENTITY . protecting SEM_MESSAGE . protecting SEM_PID . protecting SEM_MODENV . sorts Memory PlaceHolder Sys . subsort Entity < Sys . subsort EntityWithKey < Sys . subsort Memory < Sys . subsort PlaceHolder < Sys . op #downSystem : Term -> Sys [memo strat(1 0)] . op #empty-system : -> Sys [ctor] . op @:_ : Key -> PlaceHolder [prec 10 ctor] . op _||_ : Sys Sys -> Sys [assoc comm id: #empty-system prec 90 format(d sm! o d)ctor] . op `[_;_`] : Sys PlaceHolder -> Memory [prec 40 format(sg! o g! o g! o)ctor frozen(1 2)] . eq #downSystem('#empty-system.Sys) = #empty-system . eq #up(#empty-system) = '#empty-system.Sys . ceq #downSystem(T:Term) = #downEntityWithKey(T1:Term) || #downSystem(T2:Term) if SUB:Substitution := metaMatch(GRAMMAR,'_||_['E:EntityWithKey,'SYS:Sys], T:Term,nil,0)/\ 'E:EntityWithKey <- T1:Term ; 'SYS:Sys <- T2:Term := SUB:Substitution . ceq #up(SYS:Sys || E:EntityWithKey) = '_||_[#up(E:EntityWithKey),#up(SYS:Sys)] if SYS:Sys =/= #empty-system = true . endm 