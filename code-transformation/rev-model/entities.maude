mod SEM_ENTITIES is protecting SEM_ENTITY_WITH_KEY . including BOOL . protecting META-LEVEL . protecting MAUDE-SYNTAX-UPDOWN . protecting SEM_ENTITY . protecting SEM_MESSAGE . protecting SEM_PID . protecting SEM_MODENV . sorts Entities Memory PlaceHolder . subsort Entity < Entities . subsort EntityWithKey < Entities . subsort Memory < Entities . subsort PlaceHolder < Entities . op #downEntities : Term -> Entities [memo strat(1 0)] . op #empty-entities : -> Entities [ctor] . op @:_ : Key -> PlaceHolder [prec 10 ctor] . op _||_ : Entities Entities -> Entities [assoc comm id: #empty-entities prec 90 format(d sm! o d)ctor] . op `[_;_`] : Entities PlaceHolder -> Memory [prec 40 format(sg! o g! o g! o)ctor frozen(1 2)] . eq #downEntities('#empty-entities.Entities) = #empty-entities . eq #up(#empty-entities) = '#empty-entities.Entities . ceq #downEntities(T:Term) = #downEntityWithKey(T1:Term) || #downEntities(T2:Term) if SUB:Substitution := metaMatch(GRAMMAR,'_||_['E:EntityWithKey, 'ENTS:Entities],T:Term,nil,0)/\ 'E:EntityWithKey <- T1:Term ; 'ENTS:Entities <- T2:Term := SUB:Substitution . ceq #up(ENTS:Entities || E:EntityWithKey) = '_||_[#up(E:EntityWithKey),#up(ENTS:Entities)] if ENTS:Entities =/= #empty-entities = true . endm 